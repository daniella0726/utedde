<style>
@import url('https://fonts.googleapis.com/css?family=Heebo:300,400,500,700&display=swap');
.pregunta {
  padding: 12px 30px;
  width: 100%;
  display: block;
  text-align: left;
  color: #3C454C;
  font-family: 'Heebo';
  border: 1px solid #43a2d2;
  font-size: 18px;
  cursor: pointer;
  position: relative;
  z-index: 2;
  transition: color 200ms ease-in;
  overflow: hidden;
}
</style>
<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="https://kit.fontawesome.com/1f7411956b.js"></script>



<div class="container">

  <h1 style="font-family: 'Heebo', sans-serif; color: #254064; text-align: center;" >Gráficos Estudiantes</h1>
  <p>
    <a class="pregunta" data-toggle="collapse" href="#collapse_p1" role="button" aria-expanded="false" aria-controls="collapse_p1">
      P1. Distribución por grado
    </a>
  </p>
  <div class="collapse" id="collapse_p1">
    <div class="card card-body">
      <% total  = 0 %>
        <% array_sql = Estudiante.group(:p1).having("p1 != ?", "--").having("p1 != ?", "").order('COUNT(id) DESC').count(:id) %>
        <% array_sql.each do |value,item|%>
            <% total = total + item %>
        <%end%>
        <% array = [] %>
        <% array_sql.each do |value,item|%>
            <% array.push([value, (100*item/total.to_f).round(2), item]) %>   
        <%end%>
        <%= bar_chart array , name:"relativo" , colors: ["#42B598"] , suffix: "%"%>
        <br>
        <div style="text-align: center;">
        <table class="table table-bordered" style="width: 80%; text-align: center;">
              <thead>
                <tr style="text-align: center;">
                  <th scope="col" style="text-align: center;">Valor</th>
                  <th scope="col" style="text-align: center;">Cantidad</th>
                  <th scope="col" style="text-align: center;">%</th>
                </tr>
              </thead>
              <tbody>
        <% array_sql.each do |value,item|%>
              <tr style="text-align: center;">
                <th scope="row" style="text-align: center;"><%=value%></th>
                <td style="text-align: center;"><%=item%></td>
                <td style="text-align: center;"><%=(100*item/total.to_f).round(2)%></td>
              </tr>  
        <%end%>
              <tr class="table-dark" style="text-align: center;">
                <th scope="row" style="text-align: center;">Total</th>
                <td style="text-align: center;"><%= total%></td>
                <td style="text-align: center;">100%</td>
              </tr>
              </tbody>
        </table>
        </div>
    </div>
  </div>
  <br>

  



<div class="hidden">
<table>
  <thead>
    <tr>
      <th>P1</th>
      <th>P2</th>
      <th>P3</th>
      <th>P4</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @estudiantes.each do |estudiante| %>
      <tr>
        <td><%= estudiante.p1 %></td>
        <td><%= estudiante.p2 %></td>
        <td><%= estudiante.p3 %></td>
        <td><%= link_to 'Show', estudiante %></td>
        <td><%= link_to 'Edit', edit_estudiante_path(estudiante) %></td>
        <td><%= link_to 'Destroy', estudiante, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>
</div>

<% link_to 'New Estudiante', new_estudiante_path %>
